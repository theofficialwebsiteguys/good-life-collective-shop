<div class="shop-container">
  <!-- Sidebar Toggle Button (Visible on Mobile) -->
  <button class="sidebar-toggle" (click)="toggleSidebar()"
          aria-controls="filterSidebar"
          [attr.aria-expanded]="isSidebarOpen">
    ☰ Filters
  </button>
  
  <aside id="filterSidebar" class="sidebar" [class.open]="isSidebarOpen" role="complementary" aria-label="Filter options">
    <button class="close-btn" *ngIf="isSidebarOpen" (click)="toggleSidebar()" aria-label="Close filters">Close</button>
    <button class="close-btn" (click)="clearFilters()" aria-label="Clear all filters">Clear Filters</button>
  
    <!-- Strains Filter Section -->
    <div class="filter-section">
      <button type="button" class="filter-toggle" (click)="toggleSection('types')"
              [attr.aria-expanded]="isExpanded['types']" aria-controls="filter-types">
        <h3>Strains</h3>
        <span class="dash" [class.expanded]="isExpanded['types']">−</span>
      </button>
      <div id="filter-types" *ngIf="isExpanded['types']" class="filter-options">
        <label *ngFor="let type of types">
          <input type="checkbox" (change)="toggleTypeFilter(type.name)" [checked]="selectedTypes.includes(type.name)"/>
          {{ type.name }}
        </label>
      </div>
    </div>
  
    <!-- Brands Filter Section -->
    <div class="filter-section">
      <button type="button" class="filter-toggle" (click)="toggleSection('brands')"
              [attr.aria-expanded]="isExpanded['brands']" aria-controls="filter-brands">
        <h3>Brands</h3>
        <span class="dash" [class.expanded]="isExpanded['brands']">−</span>
      </button>
      <div id="filter-brands" *ngIf="isExpanded['brands']" class="filter-options">
        <ng-container *ngIf="dynamicFilterOptions$ | async as dynamicFilterOptions">
          <label *ngFor="let brand of dynamicFilterOptions.brands">
            <input type="checkbox" (change)="toggleBrandFilter(brand.value)" [checked]="selectedBrands.includes(brand.value)"/>
            {{ brand.label }}
          </label>
        </ng-container>
      </div>
    </div>
  
    <!-- Weights Filter Section -->
    <div class="filter-section">
      <button type="button" class="filter-toggle" (click)="toggleSection('weights')"
              [attr.aria-expanded]="isExpanded['weights']" aria-controls="filter-weights">
        <h3>Weights</h3>
        <span class="dash" [class.expanded]="isExpanded['weights']">−</span>
      </button>
      <div id="filter-weights" *ngIf="isExpanded['weights']" class="filter-options">
        <ng-container *ngIf="dynamicFilterOptions$ | async as dynamicFilterOptions">
          <label *ngFor="let weight of dynamicFilterOptions.weights">
            <input type="checkbox" (change)="toggleWeightsFilter(weight.value)" [checked]="selectedWeights.includes(weight.value)"/>
            {{ weight.label }}
          </label>
        </ng-container>
      </div>
    </div>
  </aside>
  
  <main class="main-content">
    <!-- Sort & Search Container -->
    <div class="sort-search-container">
      <!-- Search Bar -->
      <input type="text" [(ngModel)]="searchQuery" placeholder="Search products..." class="search-input" aria-label="Search products"/>
      
      <!-- Sort Dropdown with Visually Hidden Label -->
      <label for="sortDropdown" class="visually-hidden">Sort by</label>
      <select id="sortDropdown" [(ngModel)]="sortOption" class="sort-dropdown" (change)="updateSortOption()" aria-label="Sort products by">
        <option value="RECENT">Newest</option>
        <option value="PRICE_ASC">Price: Low to High</option>
        <option value="PRICE_DESC">Price: High to Low</option>
        <option value="THC_ASC">THC: Low to High</option>
        <option value="THC_DESC">THC: High to Low</option>
        <option value="NAME">Alphabetical</option>
      </select>
  
      <lib-cart-icon></lib-cart-icon>
      <lib-auth-nav></lib-auth-nav>
    </div>
  
    <lib-product-list 
      [category]="category"
      [selectedBrands]="selectedBrands"
      [selectedWeights]="selectedWeights"
      [selectedTypes]="selectedTypes"
      [searchQuery]="searchQuery"
      [sortOption]="sortOption">
    </lib-product-list>
  </main>
</div>
